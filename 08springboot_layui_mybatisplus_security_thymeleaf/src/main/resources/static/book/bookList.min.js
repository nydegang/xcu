layui.use("element",function(){var a=layui.element});layui.use(["table","form"],function(){var b=layui.table;layui.$.post("type/findAll",function(d){for(var c=0;c<d.length;c++){var e=new Option(d[c].name,d[c].id);layui.$("#tidSel2,#tidSel").append(e)}layui.form.render("select")});layui.form.on("submit(book-search)",function(c){b.reload("test",{url:"book/list",where:c.field});return false});b.render({elem:"#test",url:"book/list",toolbar:"#toolbarDemo",defaultToolbar:["filter","exports","print",{title:"提示",layEvent:"LAYTABLE_TIPS",icon:"layui-icon-tips"}],title:"用户数据表",cols:[[{type:"checkbox",fixed:"left"},{field:"id",title:"ID",width:80,fixed:"left",unresize:true,sort:true},{field:"name",title:"书名",width:120,edit:"text"},{field:"author",title:"作者",width:80,edit:"text",sort:true},{field:"tid",title:"类型",width:100},{field:"price",title:"价格"},{field:"descri",title:"描述",width:80,sort:true},{field:"pubdate",title:"出版日期",width:120},{field:"photo",title:"图片",width:100,sort:true,templet:function(c){return'<img src="upload/'+c.photo+'">'}},{fixed:"right",title:"操作",toolbar:"#barDemo",width:150}]],page:true,parseData:function(c){return{"code":0,"count":c.total,"data":c.records}},limits:[1,2,4,6,8],limit:1});b.on("toolbar(test)",function(e){var c=b.checkStatus(e.config.id);switch(e.event){case"getCheckData":var d=c.data;layer.alert(JSON.stringify(d));break;case"getCheckLength":var d=c.data;layer.msg("选中了："+d.length+" 个");break;case"isAll":layer.msg(c.isAll?"全选":"未全选");break;case"bookAdd":a({author:"",descri:"",id:"",name:"",photo:"",price:"",pubdate:"",tid:-1});break;case"LAYTABLE_TIPS":layer.alert("这是工具栏右侧自定义的一个图标按钮");break}});b.on("tool(test)",function(d){var c=d.data;if(d.event==="del"){layer.confirm("真的删除行么",function(e){layui.$.post("book/del",{id:c.id,page:1},function(f){layer.close(e);if(f.code==1){b.reload("test",{url:"book/list"})}else{layer.msg(f.msg,{icon:1,time:2000},function(){})}})})}else{if(d.event==="edit"){a(c,c.tid)}}});layui.form.on("submit(bookBtn)",function(c){layui.$.post("book/update",c.field,function(d){layer.closeAll();if(d.code==0){b.reload("test",{url:"book/list"})}else{layer.msg(d.msg,{icon:1,time:2000},function(){})}});return false});function a(d,c){layer.open({type:1,title:"书籍维护",content:layui.$("#bookEditDiv"),area:["50%","75%"],success:function(e,f){layui.form.val("bookEditLay",d);if(d.photo){layui.$("#previewImg").attr("src","upload/"+d.photo)}else{layui.$("#previewImg").attr("src","")}}})}});layui.use("laydate",function(){var a=layui.laydate;a.render({elem:"#pubdateInput"})});layui.use("upload",function(){var a=layui.upload;var b=a.render({elem:"#photoxInput",url:"book/upload",field:"photox",choose:function(c){c.preview(function(e,f,d){layui.$("#previewImg").attr("src",d)})},done:function(c){layui.$("#photoInput").val(c.newFileName)},error:function(){}})});